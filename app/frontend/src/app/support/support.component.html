<div class="chat-container">
    <div class="sidebar">
        <div class="search-bar">
            <input type="text" [(ngModel)]="searchTerm" class="search-input" placeholder="Search by name" />
            <select [(ngModel)]="statusFilter" class="status-filter">
                <option [ngValue]="null">All</option>
                <option [ngValue]="ChatStatus.NOT_STARTED">Not Claimed</option>
                <option [ngValue]="ChatStatus.IN_PROGRESS">Claimed By Me</option>
                <option [ngValue]="ChatStatus.RESOLVED">Done</option>
            </select>
        </div>
        <div class="contacts-list">
            @for(index of filteredChatIndices; track $index) {
                <div class="contact" (click)="changeChat(index)">
                    <div class="avatar sailor-icon">{{chats[index].firstname[0]}}{{chats[index].lastname[0]}}</div>
                    <div class="contact-info">
                        <div class="contact-name">{{chats[index].firstname}} {{chats[index].lastname}}</div>
                        <div class="contact-role">{{chats[index].shipname}}</div>
                    </div>
                    <span class="status-badge" [ngClass]="statusClassMap[chats[index].status]">{{ chats[index].status.toString().replace('_', ' ').toLocaleLowerCase() | titlecase }}</span>
                </div>
            }
        </div>
    </div>
    <div class="chat-area">
        <div class="chat-header">
            <div class="chat-title">{{currentChat.firstname}} {{currentChat.lastname}}</div>
            @if(currentChat.status.toString()=='NOT_STARTED') {
                <button class="claim-button" (click)="claimSupportTicket()">Claim ticket</button>
            }
            @else if(currentChat.id!=0) {
                <button class="resolve-button" [ngClass]="{ resolved: currentChat.status.toString() == 'RESOLVED' }" (click)="markAsResolved()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                    Mark as Resolved
                </button>
            }
        </div>
        <div class="message-area" #chatBody>
            @for(message of messageList; track $index) {
                <div class="message" [ngClass]="{ 'my-message': message.chat_member_id === currentChatMemberId }">
                    <div class="message-bubble" [ngClass]="">
                        {{message.text_content}}
                    </div>
                    <div class="message-meta">{{message.date_time | date:'d/MM/yyyy, H:mm:ss'}}</div>
                </div>
            }
        </div>
        <div class="input-area">
            @if(currentChat.status.toString() == "IN_PROGRESS") {
                <input type="text" class="message-input" placeholder="Type your message..." [(ngModel)]="message" (keydown.enter)="sendMessage()" maxlength="255">
                <button class="send-button" (click)="sendMessage()">
                    <fa-icon [icon]="faPaperPlane"></fa-icon>
                </button>
            }
            @else if(currentChat.status.toString() == "RESOLVED") {
                <div>This ticket has been resolved.</div>
            }
            @else if(currentChat.status.toString() == "NOT_STARTED") {
                <div>Claim this ticket to help.</div>
            }
        </div>
    </div>
</div>